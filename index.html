<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Form with Autocomplete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Back Button Styles */
        .back-button {
            padding: 12px 24px;
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .back-button:hover {
            background-color: white;
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .back-button:active {
            transform: translateX(-1px);
        }

        /* Form Container */
        .address-form {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h2 {
            margin-bottom: 10px;
            color: #333;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[type="text"]::placeholder {
            color: #999;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .hint {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
            font-style: italic;
        }

        /* Button Styles */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-verify {
            background-color: #6c757d;
            color: white;
        }

        .btn-verify:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        /* Loading Indicator */
        .loading {
            display: none;
            text-align: center;
            padding: 15px;
            color: #667eea;
            font-weight: 500;
        }

        .loading.active {
            display: block;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Verification Result Styles */
        .verification-result {
            margin-top: 20px;
            padding: 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .verification-result.success {
            background-color: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }

        .verification-result.error {
            background-color: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }

        .verification-result.warning {
            background-color: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
        }

        .verification-result strong {
            display: block;
            margin-bottom: 5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .address-form {
                padding: 25px;
            }

            h2 {
                font-size: 24px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }

        /* Pac Container (Google Autocomplete Dropdown) Styling */
        .pac-container {
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-family: inherit;
        }

        .pac-item {
            padding: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- BACK BUTTON -->
        <button onclick="goBack()" class="back-button" type="button">
            ‚Üê Go Back
        </button>

        <!-- ADDRESS FORM -->
        <div class="address-form">
            <h2>Enter Your Address</h2>
            <p class="subtitle">Use autocomplete or fill in manually</p>

            <!-- Google Places Autocomplete -->
            <div class="form-group">
                <label for="autocomplete">üîç Search Address</label>
                <input id="autocomplete" type="text" placeholder="Start typing your address..." />
                <p class="hint">Select from dropdown or fill fields below</p>
            </div>

            <!-- Manual Entry Form -->
            <form id="addressForm">
                <div class="form-group">
                    <label for="street">Street Address *</label>
                    <input type="text" id="street" name="street" placeholder="123 Main Street" required />
                </div>

                <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" name="city" placeholder="Springfield" required />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="state">State *</label>
                        <input type="text" id="state" name="state" placeholder="CA" maxlength="2"
                            style="text-transform: uppercase;" required />
                    </div>

                    <div class="form-group">
                        <label for="zip">ZIP Code *</label>
                        <input type="text" id="zip" name="zip" placeholder="12345" pattern="[0-9]{5}(-[0-9]{4})?"
                            required />
                    </div>
                </div>

                <!-- Hidden Country Field -->
                <input type="hidden" id="country" name="country" value="US">

                <!-- Loading Indicator -->
                <div id="loading" class="loading">
                    Verifying address
                </div>

                <!-- Verification Result -->
                <div id="verificationResult"></div>

                <!-- Button Group -->
                <div class="button-group">
                    <button type="button" onclick="verifyAddress()" class="btn btn-verify">
                        Verify Address
                    </button>
                    <button type="submit" class="btn btn-submit" id="submitBtn">
                        Continue ‚Üí
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Google Maps JavaScript API -->
    <!-- IMPORTANT: Replace YOUR_API_KEY_HERE with your actual Google Maps API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places"></script>

    <script>
        // ==============================================
        // BACK BUTTON FUNCTION
        // ==============================================
        function goBack() {
            // Check if there are unsaved changes
            if (hasUnsavedChanges) {
                const confirmLeave = confirm('You have unsaved changes. Are you sure you want to go back?');
                if (confirmLeave) {
                    window.history.back();
                }
            } else {
                window.history.back();
            }
        }

        // ==============================================
        // GOOGLE PLACES AUTOCOMPLETE
        // ==============================================
        let autocomplete;

        function initAutocomplete() {
            const input = document.getElementById('autocomplete');

            // Initialize Google Places Autocomplete
            autocomplete = new google.maps.places.Autocomplete(input, {
                types: ['address'],
                componentRestrictions: { country: 'us' } // Change to your country code if needed
            });

            // Listen for place selection
            autocomplete.addListener('place_changed', onPlaceChanged);
        }

        function onPlaceChanged() {
            const place = autocomplete.getPlace();

            if (!place.address_components) {
                console.log('No address details available');
                showVerificationResult('warning', 'Please select an address from the dropdown');
                return;
            }

            // Parse address components
            let street = '';
            let city = '';
            let state = '';
            let zip = '';
            let country = '';

            place.address_components.forEach(component => {
                const types = component.types;

                if (types.includes('street_number')) {
                    street = component.long_name + ' ';
                }
                if (types.includes('route')) {
                    street += component.long_name;
                }
                if (types.includes('locality')) {
                    city = component.long_name;
                }
                if (types.includes('administrative_area_level_1')) {
                    state = component.short_name;
                }
                if (types.includes('postal_code')) {
                    zip = component.long_name;
                }
                if (types.includes('country')) {
                    country = component.long_name;
                }
            });

            // Fill in the form fields
            document.getElementById('street').value = street;
            document.getElementById('city').value = city;
            document.getElementById('state').value = state;
            document.getElementById('zip').value = zip;
            document.getElementById('country').value = country;

            // Show success message
            showVerificationResult('success', '‚úì Address verified successfully via Google Places!');

            // Mark as having changes
            hasUnsavedChanges = true;
        }

        // ==============================================
        // ADDRESS VERIFICATION
        // ==============================================
        function verifyAddress() {
            const street = document.getElementById('street').value.trim();
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value.trim().toUpperCase();
            const zip = document.getElementById('zip').value.trim();

            // Clear previous results
            document.getElementById('verificationResult').innerHTML = '';

            // Basic validation
            const errors = [];
            const warnings = [];

            if (!street) errors.push('Street address is required');
            if (!city) errors.push('City is required');
            if (!state) errors.push('State is required');
            if (!zip) errors.push('ZIP code is required');

            // Format validation
            const zipRegex = /^\d{5}(-\d{4})?$/;
            if (zip && !zipRegex.test(zip)) {
                warnings.push('ZIP code format may be invalid. Expected: 12345 or 12345-6789');
            }

            const stateRegex = /^[A-Z]{2}$/;
            if (state && !stateRegex.test(state)) {
                warnings.push('State should be a two-letter code (e.g., CA, NY, TX)');
            }

            if (street && street.length < 5) {
                warnings.push('Street address seems too short');
            }

            // Show errors if any
            if (errors.length > 0) {
                showVerificationResult('error', '‚úó Please fix the following:<br>' + errors.join('<br>'));
                return;
            }

            // Show warnings if any (but continue to API verification)
            if (warnings.length > 0) {
                showVerificationResult('warning', '‚ö† Warning:<br>' + warnings.join('<br>'));
            }

            // If basic validation passes, verify with Google API
            verifyAddressWithAPI(street, city, state, zip);
        }

        async function verifyAddressWithAPI(street, city, state, zip) {
            const apiKey = 'YOUR_API_KEY_HERE'; // Replace with your actual API key
            const address = `${street}, ${city}, ${state} ${zip}`;

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('verificationResult').innerHTML = '';

            try {
                const response = await fetch(
                    `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${apiKey}`
                );

                const data = await response.json();

                // Hide loading
                document.getElementById('loading').classList.remove('active');

                if (data.status === 'OK' && data.results.length > 0) {
                    const result = data.results[0];
                    const locationType = result.geometry.location_type;

                    let confidence = 'High';
                    if (locationType === 'RANGE_INTERPOLATED') {
                        confidence = 'Medium';
                    } else if (locationType === 'GEOMETRIC_CENTER' || locationType === 'APPROXIMATE') {
                        confidence = 'Low';
                    }

                    showVerificationResult(
                        'success',
                        `<strong>‚úì Address Verified!</strong><br>` +
                        `Formatted: ${result.formatted_address}<br>` +
                        `Confidence: ${confidence}<br>` +
                        `Coordinates: ${result.geometry.location.lat.toFixed(6)}, ${result.geometry.location.lng.toFixed(6)}`
                    );
                } else if (data.status === 'ZERO_RESULTS') {
                    showVerificationResult(
                        'error',
                        '<strong>‚úó Address Not Found</strong><br>Please check for typos and try again.'
                    );
                } else if (data.status === 'REQUEST_DENIED') {
                    showVerificationResult(
                        'error',
                        '<strong>‚úó API Error</strong><br>Please check your API key configuration.'
                    );
                } else {
                    showVerificationResult(
                        'error',
                        `<strong>‚úó Verification Failed</strong><br>Status: ${data.status}`
                    );
                }
            } catch (error) {
                document.getElementById('loading').classList.remove('active');
                showVerificationResult(
                    'error',
                    '<strong>‚úó Connection Error</strong><br>Unable to connect to verification service. Please check your internet connection.'
                );
                console.error('Verification error:', error);
            }
        }

        function showVerificationResult(type, message) {
            const resultDiv = document.getElementById('verificationResult');
            resultDiv.className = `verification-result ${type}`;
            resultDiv.innerHTML = message;
        }

        // ==============================================
        // FORM SUBMISSION
        // ==============================================
        document.getElementById('addressForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const address = {
                street: document.getElementById('street').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value.toUpperCase(),
                zip: document.getElementById('zip').value,
                country: document.getElementById('country').value
            };

            console.log('Address submitted:', address);

            // Reset unsaved changes flag
            hasUnsavedChanges = false;

            // Here you can:
            // 1. Send to your server via fetch/AJAX
            // 2. Store in localStorage
            // 3. Navigate to next page

            // Example: Send to server
            /*
            fetch('/api/save-address', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(address)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                window.location.href = '/next-page.html';
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Failed to save address. Please try again.');
            });
            */

            // For demo purposes, just show alert
            alert('Address submitted successfully!\n\n' + JSON.stringify(address, null, 2));

            // Uncomment to navigate to another page:
            // window.location.href = '/next-page.html';
        });

        // ==============================================
        // TRACK UNSAVED CHANGES
        // ==============================================
        let hasUnsavedChanges = false;

        document.getElementById('addressForm').addEventListener('input', function () {
            hasUnsavedChanges = true;
        });

        // Warn before leaving if there are unsaved changes
        window.addEventListener('beforeunload', function (e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
            }
        });

        // ==============================================
        // AUTO-UPPERCASE STATE FIELD
        // ==============================================
        document.getElementById('state').addEventListener('input', function (e) {
            e.target.value = e.target.value.toUpperCase();
        });

        // ==============================================
        // INITIALIZE ON PAGE LOAD
        // ==============================================
        window.addEventListener('load', function () {
            initAutocomplete();
            console.log('Address form initialized successfully!');
        });
    </script>
</body>

</html>